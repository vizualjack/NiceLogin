<head>
    <style>
        .checklistPage {
            background-color: darkgray;
            display: block;
            width: 100%;
            height: 100%;
        }

        .checklistPage h1 {
            color: blueviolet;
        }

        .checklistPage span[role="button"] {
            display: inline-block;
            padding: 0;
        }
    </style>

    <script>
        async function getChecks() {
            const response = await fetch("checklist/checks", {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                } 
            });
            return response.json();
        }

        async function sendNewCheck(text) {
            const response = await fetch("checklist/create", {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({text: text}) 
            });
            return response;
        }

        async function sendChangeCheck(id) {
            const response = await fetch("checklist/changeStatus", {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({checkId: id}) 
            });
            return response;
        }

        async function sendRemoveCheck(id) {
            const response = await fetch("checklist/delete", {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({checkId: id}) 
            });
            return response;
        }

        async function showChecks() {
            let checks = document.querySelector("div.checks");
            clean(checks, 0);
            let checkExample = document.querySelector(".check");
            (await getChecks()).forEach(check => {
                let newCheck = checkExample.cloneNode(true);
                let input = newCheck.querySelector("input");
                input.id = check._id;
                input.checked = check.checked;
                newCheck.querySelector("label").innerHTML = check.text;
                newCheck.style.display = "block";
                checks.append(newCheck);
            });
        }

        async function changeStatus(event) {
            let check = event.target;
            if(check.id && await sendChangeCheck(check.id)) showChecks();
        }

        async function removeCheck(delBtn) {
            let check = event.target.parentElement.querySelector("input");
            if(check.id && await sendRemoveCheck(check.id)) showChecks();
        }

        async function clean(element, startIndex) {
            if(element.children.length <= 0) return;
            for(let i = element.children.length-1; i > startIndex; i--) {
                element.children[i].remove();
            }
        }

        async function createNewCheck() {
            let newCheckInput = document.querySelector("input[name=newCheckText]");
            if(await sendNewCheck(newCheckInput.value)) showChecks();
        }

        showChecks();
    </script>
</head>

<body>
    <div class="checklistPage">
        <h1>Checklist</h1>
        <div class="checks">
            <div class="check" style="display: none">
                <input type="checkbox" onchange="changeStatus(event)"/>
                <label>example</label>
                <span role="button" onclick="removeCheck(event)">X</span>
            </div>
        </div>
        <div class="newCheck">
            <input type="text" name="newCheckText"/>
            <button onclick="createNewCheck()">Create</button>
        </div>
    </div>
</body>